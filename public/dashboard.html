<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Portrait Intelligence Lab™</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
  <div class="nav-container">
    <div class="logo">
      <a href="/">Portrait Intelligence Lab</a>
    </div>

    <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Menu">
           <span></span>
          <span></span>
          <span></span>
    </button>

      <ul class="nav-links" id="nav-links">
        <li><a href="/">Home</a></li>
       <li><a href="/dashboard">Dashboard</a></li>
       <li><a href="/micro-actions">Micro-Actions</a></li>
       <li><a href="/battle/register">Battles</a></li>
      </ul>
     </div>
  </nav>


    <div class="container">
        <h1 style="font-size: 2.5rem; margin: 2rem 0; color: var(--dark);">Your Dashboard</h1>
        
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>✔ Your Current Tier</h3>
                <div class="status-value" id="current-tier">Loading...</div>
                <div class="status-description" id="tier-description">Checking your tier status...</div>
                <div style="margin-top: 1rem;">
                    <a href="/" class="btn btn-primary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">View All Tiers</a>
                </div>
            </div>

            <div class="dashboard-card">
                <h3>✔ Your Progress</h3>
                <div class="status-value" id="progress-percentage">0%</div>
                <div class="status-description" id="progress-description">Micro-actions completed</div>
                <div class="progress-container" style="margin-top: 1rem;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <a href="/micro-actions" class="btn btn-primary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">View Micro-Actions</a>
                </div>
            </div>

            <div class="dashboard-card">
                <h3>✔ Battles You Can Join</h3>
                <div class="status-value" id="battle-status">Checking...</div>
                <div class="status-description" id="battle-description">Your battle eligibility</div>
                <div id="battle-info" style="margin-top: 1rem;"></div>
                <div style="margin-top: 1rem;">
                    <a href="/battle/register" class="btn btn-primary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">Register for Battle</a>
                </div>
            </div>

            <div class="dashboard-card">
                <h3>✔ Circle Status</h3>
                <div class="status-value" id="circle-status">Checking...</div>
                <div class="status-description" id="circle-description">Your Circle membership</div>
                <div id="circle-info" style="margin-top: 1rem;"></div>
                <div style="margin-top: 1rem;" id="circle-actions"></div>
            </div>
        </div>

        <div class="card" style="margin-top: 3rem;">
            <h2 style="font-size: 1.75rem; margin-bottom: 1rem;">Quick Actions</h2>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <a href="/micro-actions" class="btn btn-primary">Complete Micro-Actions</a>
                <a href="/battle/register" class="btn btn-secondary">Join a Battle</a>
                <a href="/" class="btn btn-success">Explore Tiers</a>
            </div>
        </div>
    </div>

    <script src="/js/app.js"></script>
    <script>
        async function loadDashboard() {
            const user = await fetchUserData();
            if (!user) {
                showAlert('Error loading dashboard data', 'warning');
                return;
            }

            // Current Tier
            const highestTier = getHighestTier(user.tiers);
            document.getElementById('current-tier').textContent = formatTierName(highestTier);
            document.getElementById('tier-description').textContent = `You have access to ${user.tiers.length} tier(s)`;

            // Progress
            const progress = calculateProgress(user.microActions);
            document.getElementById('progress-percentage').textContent = `${progress}%`;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            const completed = user.microActions.filter(a => a === true).length;
            document.getElementById('progress-description').textContent = `${completed} of 7 micro-actions completed`;

            // Battle Status
            const canJoinBattles = user.tiers.includes('199') || user.tiers.includes('999') || user.tiers.includes('9999') || user.tiers.includes('circle');
            if (canJoinBattles) {
                document.getElementById('battle-status').textContent = 'Eligible';
                document.getElementById('battle-status').style.color = 'var(--success)';
                document.getElementById('battle-description').textContent = 'You can register for battles';
                if (user.battles && user.battles.length > 0) {
                    document.getElementById('battle-info').innerHTML = `<span class="badge badge-success">Registered: ${user.battles.length} battle(s)</span>`;
                }
            } else {
                document.getElementById('battle-status').textContent = 'Not Eligible';
                document.getElementById('battle-status').style.color = 'var(--text-light)';
                document.getElementById('battle-description').textContent = 'Upgrade to Access Pass or higher';
            }

            // Circle Status
            if (user.circleInvite || user.tiers.includes('circle') || user.tiers.includes('9999')) {
                document.getElementById('circle-status').textContent = 'Member';
                document.getElementById('circle-status').style.color = 'var(--accent)';
                document.getElementById('circle-description').textContent = 'Welcome to The Circle';
                if (user.pod) {
                    document.getElementById('circle-info').innerHTML = `<span class="badge badge-info">Pod: ${user.pod}</span>`;
                } else {
                    document.getElementById('circle-actions').innerHTML = '<a href="/circle/pod" class="btn btn-success" style="font-size: 0.9rem; padding: 0.5rem 1rem;">Join Your Pod</a>';
                }
            } else {
                document.getElementById('circle-status').textContent = 'Not a Member';
                document.getElementById('circle-status').style.color = 'var(--text-light)';
                document.getElementById('circle-description').textContent = 'Join The Circle for exclusive access';
                document.getElementById('circle-actions').innerHTML = '<a href="/tier/9999" class="btn btn-success" style="font-size: 0.9rem; padding: 0.5rem 1rem;">Learn About The Circle</a>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadDashboard);
    </script>

  <script src="/js/main.js"></script>
</body>
</html>

