<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - Portrait Intelligence Lab‚Ñ¢</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">Portrait Intelligence Lab‚Ñ¢</div>
            <button class="mobile-menu-btn" id="mobile-menu-btn">‚ò∞</button>
            <ul class="nav-links" id="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/dashboard">Dashboard</a></li>
            </ul>
        </div>
    </nav>

    <div class="payment-hero">
        <div class="container">
            <h1>Complete Your Purchase</h1>
            <p id="tier-info" style="font-size: 1.25rem; margin-top: 1rem; opacity: 0.95;">
                Processing your tier selection...
            </p>
        </div>
    </div>

    <div class="container">
        <div class="card" style="max-width: 600px; margin: -3rem auto 2rem; position: relative; z-index: 10;">
            <div class="payment-section" style="background: transparent; padding: 0;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üí≥</div>
                    <h2 style="font-size: 1.75rem; margin-bottom: 0.5rem;">Secure Payment</h2>
                    <p style="color: var(--text-light);">
                        Your payment is processed securely through Razorpay
                    </p>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <button class="payment-btn-razorpay-single" id="razorpay-btn">
                        <span style="font-size: 1.25rem; margin-right: 0.5rem;">üîí</span>
                        Pay with Razorpay
                    </button>
                </div>

                <div style="background: var(--light); padding: 1.5rem; border-radius: 0.5rem; margin-top: 2rem;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
                        <span style="color: var(--text-light);">Tier:</span>
                        <span style="font-weight: 600;" id="tier-name-display"></span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <span style="color: var(--text-light);">Amount:</span>
                        <span style="font-weight: 700; font-size: 1.25rem; color: var(--primary);" id="tier-price-display"></span>
                    </div>
                </div>

                <p style="color: var(--text-light); font-size: 0.875rem; margin-top: 2rem; text-align: center; line-height: 1.6;">
                    üîê Your information is encrypted and secure. We use industry-standard SSL encryption to protect your data.
                </p>
            </div>

            <div style="margin-top: 2rem; text-align: center;">
                <a href="/" class="btn btn-secondary">Cancel</a>
            </div>
        </div>
    </div>

    <script src="/js/app.js"></script>
    <script>
        // Get tier from URL
        const urlParams = new URLSearchParams(window.location.search);
        const tier = urlParams.get('tier');
        const tierMap = {
            '9.99': { name: 'Starter Tier', price: '$9.99' },
            '19.99': { name: 'Professional Tier', price: '$19.99' },
            '199': { name: 'Access Pass', price: '$199' },
            '999': { name: 'Elite Challenge', price: '$999' },
            '9999': { name: 'The Circle', price: '$9,999' }
        };

        if (tier && tierMap[tier]) {
            const tierInfo = tierMap[tier];
            document.getElementById('tier-info').textContent = `You're purchasing: ${tierInfo.name}`;
            document.getElementById('tier-name-display').textContent = tierInfo.name;
            document.getElementById('tier-price-display').textContent = tierInfo.price;
        } else {
            document.getElementById('tier-info').textContent = 'Invalid tier selection';
            document.getElementById('tier-info').style.color = 'var(--danger)';
        }

        // Razorpay button handler
        document.getElementById('razorpay-btn').addEventListener('click', async () => {
            if (!tier) {
                showAlert('Invalid tier selection', 'warning');
                return;
            }
            
            // Disable button during processing
            const btn = document.getElementById('razorpay-btn');
            btn.disabled = true;
            btn.style.opacity = '0.6';
            btn.textContent = 'Processing...';
            
            // In production, this would redirect to Razorpay Checkout
            // For now, simulate payment success
            try {
                const paymentId = 'razorpay_' + Date.now();
                const result = await confirmPayment(tier, paymentId);
                
                if (result && result.success) {
                    // Redirect to confirmation page
                    window.location.href = `/payment/confirm?tier=${tier}&paymentId=${paymentId}&method=Razorpay`;
                } else {
                    showAlert('Payment failed. Please try again.', 'warning');
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    btn.innerHTML = '<span style="font-size: 1.25rem; margin-right: 0.5rem;">üîí</span>Pay with Razorpay';
                }
            } catch (error) {
                showAlert('Payment error. Please try again.', 'warning');
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.innerHTML = '<span style="font-size: 1.25rem; margin-right: 0.5rem;">üîí</span>Pay with Razorpay';
            }
        });
    </script>
</body>
</html>
